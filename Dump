SELECT 
    T.TEST_ID AS TEST_ID
FROM
    RT_CONTROL AS C
    LEFT JOIN BO_TEST AS T ON T.TEST_ID = LATEST_TESTRESULT.TEST_ID
    LEFT JOIN BO_TESTRESULT AS R ON LATEST_TESTRESULT.TESTRESULT_ID = R.TESTRESULT_ID
    LEFT JOIN ACTORINFO AS U_CHECKED_IN_BY ON U_CHECKED_IN_BY.ACTORID = C.U_CHECKED_IN_BY
    LEFT JOIN ACTORINFO AS U_CREATOR ON U_CREATOR.ACTORID = C.CREATOR
    LEFT JOIN (
        SELECT 
            CO.CONTROL,
            MAX(T2.TEST_ID) AS TEST_ID
        FROM
            RT_CONTROL AS CO
            INNER JOIN BO__CONTROL_TEST AS CTL2 ON CO.CONTROL_ID = CTL2.CONTROL_ID
            INNER JOIN BO_TEST AS T2 ON CTL2.TEST_ID = T2.TEST_ID
            INNER JOIN RT_TEST AS T3 ON T2.TEST_ID = T3.TEST_ID
        WHERE
            T2.DELMARK = 'No'
            AND T3.CREATION_DATE IN (
                SELECT MAX(ET2.CREATION_DATE) AS CREATION_DATE
                FROM 
                    RT_CONTROL AS ECO
                    INNER JOIN BO__CONTROL_TEST AS ECTL2 ON ECO.CONTROL_ID = ECTL2.CONTROL_ID
                    INNER JOIN RT_TEST AS ET2 ON ECTL2.TEST_ID = ET2.TEST_ID
                    INNER JOIN BO_TEST AS ET3 ON ET2.TEST_ID = ET3.TEST_ID
                WHERE
                    ET3.DELMARK = 'No'
                    AND ECO.CONTROL_ID = CO.CONTROL_ID
            )
        GROUP BY CO.CONTROL_ID
    ) AS LATEST_TESTPLAN ON C.CONTROL_ID = LATEST_TESTPLAN.CONTROL_ID
    LEFT JOIN (
        SELECT
            TE.TEST_ID AS TEST_ID,
            MAX(TR.TESTRESULT_ID) AS TESTRESULT_ID
        FROM
            BO_TEST AS TE
            LEFT JOIN BO__TEST_TESTRESULT AS TTL2 ON TE.TEST_ID = TTL2.TEST_ID
            LEFT JOIN BO_TESTRESULT AS TR ON TTL2.TESTRESULT_ID = TR.TESTRESULT_ID
            INNER JOIN RT_TESTRESULT AS TR2 ON TR.TESTRESULT_ID = TR2.TESTRESULT_ID
        WHERE
            TR.DELMARK = 'No'
            AND TR2.CREATION_DATE IN (
                SELECT MAX(ET2.CREATION_DATE) AS CREATION_DATE
                FROM
                    RT_TEST AS ETI
                    INNER JOIN BO__TEST_TESTRESULT AS ECTL2 ON ETI.TEST_ID = ECTL2.TEST_ID
                    INNER JOIN RT_TESTRESULT AS ET2 ON ECTL2.TESTRESULT_ID = ET2.TESTRESULT_ID
                    INNER JOIN BO_TESTRESULT AS ET3 ON ET2.TESTRESULT_ID = ET3.TESTRESULT_ID
                WHERE
                    ET3.DELMARK = 'No'
                    AND ETI.TEST_ID = TE.TEST_ID
            )
        GROUP BY TE.TEST_ID
    ) AS LATEST_TESTRESULT ON T.TEST_ID = LATEST_TESTRESULT.TEST_ID
WHERE
    C.REPORTING_PERIOD_ID = -1
    AND LATEST_TESTRESULT.TESTRESULT_ID = R.TESTRESULT_ID;
