SELECT
    I.KEYRISKINDICATOR_ID
FROM
    RT_KEYRISKINDICATOR AS I
LEFT JOIN BO_ENUMVALS AS E_TYPE00 ON E_TYPE00.ENUMVALID = I.TYPE00,
LEFT JOIN BO_ENUMVALS AS E_STATUS ON E_STATUS.ENUMVALID = I.STATUS,
LEFT JOIN BO_ENUMVALS AS E_FREQUENCY00 ON E_FREQUENCY00.ENUMVALID = I.FREQUENCY00,
LEFT JOIN BO_ENUMVALS AS E_UNIT_OF_MEASURE00 ON E_UNIT_OF_MEASURE00.ENUMVALID = I.UNIT_OF_MEASURE00,
LEFT JOIN BO_ENUMVALS AS E_DIRECTION_INFORMATION00 ON E_DIRECTION_INFORMATION00.ENUMVALID = I.DIRECTION_INFORMATION00,
LEFT JOIN BO_ENUMVALS AS E_ORGANISATION ON E_ORGANISATION.ENUMVALID = I.ORGANISATION,
LEFT JOIN BO_ENUMVALS AS E_CATL1 ON E_CATL1.ENUMVALID = I.CATL1,
LEFT JOIN BO_ENUMVALS AS E_CATL2 ON E_CATL2.ENUMVALID = I.CATL2,
LEFT JOIN BO_ENUMVALS AS E_BREACH_STATUS ON E_BREACH_STATUS.ENUMVALID = I.BREACH_STATUS,
LEFT JOIN BO_ENUMVALS AS E_INDICATOR_TREND ON E_INDICATOR_TREND.ENUMVALID = I.INDICATOR_TREND,
LEFT JOIN BO_ENUMVALS AS E_DELMARK ON E_DELMARK.ENUMVALID = I.DELMARK,
LEFT JOIN ACTORINFO AS U_CHECKED_IN_BY ON U_CHECKED_IN_BY.ACTORID = I.CHECKED_IN_BY,
LEFT JOIN ACTORINFO AS U_CREATOR ON U_CREATOR.ACTORID = I.CREATOR,
LEFT JOIN BO_KEYRISKINDICATORVALUE AS VL ON I.KEYRISKINDICATOR_ID = VL.KEYRISKINDICATOR_ID,
LEFT JOIN BO_KEYRISKINDICATORVALUE AS VP1 ON I.KEYRISKINDICATOR_ID = VP1.KEYRISKINDICATOR_ID,
LEFT JOIN BO_KEYRISKINDICATORVALUE AS VP2 ON I.KEYRISKINDICATOR_ID = VP2.KEYRISKINDICATOR_ID,
LEFT JOIN (
    SELECT
        REL1.KEYRISKINDICATOR_ID,
        RE1.KEYRISKINDICATORVAL_ID,
        RE1.CREATION_DATE,
        ROW_NUMBER() OVER (PARTITION BY REL1.KEYRISKINDICATOR_ID ORDER BY RE1.VALUE_DATE DESC, RE1.KEYRISKINDICATORVAL_ID) AS ROW_NUMBER
    FROM
        RT__KEYRISKINDICATOR_KEYRISKIN AS REL1
    LEFT JOIN BO_KEYRISKINDICATORVALUE AS RE1 ON REL1.KEYRISKINDICATORVAL_ID = RE1.KEYRISKINDICATORVAL_ID
    WHERE
        REL1.REPORTING_PERIOD_ID = RE1.REPORTING_PERIOD_ID
        AND RE1.DELMARK = 'No'
) AS LATEST_IND_VAL ON I.KEYRISKINDICATOR_ID = LATEST_IND_VAL.KEYRISKINDICATOR_ID
LEFT JOIN (
    SELECT
        REL1.KEYRISKINDICATOR_ID,
        RE1.KEYRISKINDICATORVAL_ID,
        RE1.CREATION_DATE,
        ROW_NUMBER() OVER (PARTITION BY REL1.KEYRISKINDICATOR_ID ORDER BY RE1.VALUE_DATE DESC, RE1.KEYRISKINDICATORVAL_ID) AS ROW_NUMBER
    FROM
        RT__KEYRISKINDICATOR_KEYRISKIN AS REL1
    LEFT JOIN BO_KEYRISKINDICATORVALUE AS RE1 ON REL1.KEYRISKINDICATORVAL_ID = RE1.KEYRISKINDICATORVAL_ID
    WHERE
        REL1.REPORTING_PERIOD_ID = RE1.REPORTING_PERIOD_ID
        AND RE1.DELMARK = 'No'
) AS PRIOR1_IND_VAL ON I.KEYRISKINDICATOR_ID = PRIOR1_IND_VAL.KEYRISKINDICATOR_ID
LEFT JOIN (
    SELECT
        REL1.KEYRISKINDICATOR_ID,
        RE1.KEYRISKINDICATORVAL_ID,
        RE1.CREATION_DATE,
        ROW_NUMBER() OVER (PARTITION BY REL1.KEYRISKINDICATOR_ID ORDER BY RE1.VALUE_DATE DESC, RE1.KEYRISKINDICATORVAL_ID) AS ROW_NUMBER
    FROM
        RT__KEYRISKINDICATOR_KEYRISKIN AS REL1
    LEFT JOIN BO_KEYRISKINDICATORVALUE AS RE1 ON REL1.KEYRISKINDICATORVAL_ID = RE1.KEYRISKINDICATORVAL_ID
    WHERE
        REL1.REPORTING_PERIOD_ID = RE1.REPORTING_PERIOD_ID
        AND RE1.DELMARK = 'No'
) AS PRIOR2_IND_VAL ON I.KEYRISKINDICATOR_ID = PRIOR2_IND_VAL.KEYRISKINDICATOR_ID
WHERE
    I.REPORTING_PERIOD_ID = -1
    AND LATEST_IND_VAL.ROW_NUMBER = 1
    AND PRIOR1_IND_VAL.ROW_NUMBER = 2
    AND PRIOR2_IND_VAL.ROW_NUMBER = 3
